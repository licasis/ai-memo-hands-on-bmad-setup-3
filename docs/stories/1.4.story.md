# Story 1.4: 로그아웃 기능

## Status
Ready for Review

## Story
**As a** 로그인한 사용자,
**I want** 로그아웃할 수 있도록,
**so that** 계정 보안을 유지하고 다른 사용자가 내 계정을 사용할 수 없도록 한다

## Acceptance Criteria
1. 사용자가 로그아웃 버튼을 클릭할 수 있다
2. 로그아웃 시 사용자 세션이 종료된다
3. 로그아웃 후 로그인 페이지로 리다이렉트된다
4. 로그아웃 후 대시보드에 접근할 수 없다
5. 로그아웃 중에 로딩 상태가 표시된다
6. 로그아웃 실패 시 에러 메시지를 표시한다

## Tasks / Subtasks
- [x] 로그아웃 버튼 컴포넌트 구현 (AC: 1, 5)
  - [x] 로그아웃 버튼 UI
  - [x] 로딩 상태 표시
  - [x] 에러 메시지 표시
- [x] 로그아웃 서버 액션 구현 (AC: 2, 6)
  - [x] Supabase Auth signOut 호출
  - [x] 세션 정리
  - [x] 에러 핸들링
- [x] 대시보드에 로그아웃 기능 통합 (AC: 1, 3)
  - [x] 대시보드 헤더에 로그아웃 버튼 추가
  - [x] 로그아웃 후 리다이렉트 처리
- [x] 인증 상태 관리 개선 (AC: 4)
  - [x] 로그아웃 후 보호된 페이지 접근 차단
  - [x] 세션 상태 실시간 업데이트
- [x] 테스트 작성
  - [x] 로그아웃 성공 케이스 테스트
  - [x] 로그아웃 실패 케이스 테스트
  - [x] 보호된 페이지 접근 차단 테스트

## Dev Notes

### 기술 스택 정보
- **프레임워크:** Next.js (App Router, Server Actions) [Source: architecture.md#1]
- **UI:** shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **DB/인증:** Supabase (Postgres, Auth, Storage) [Source: architecture.md#1]
- **호스팅:** Vercel (Preview/Prod) [Source: architecture.md#1]

### 데이터 모델
- 로그아웃은 Supabase Auth의 내장 기능을 사용
- 별도의 데이터베이스 테이블이 필요하지 않음
- 세션 토큰이 무효화됨

### 보안 요구사항
- **권한 스코프:** 모든 인증 관련 로직은 Supabase Auth를 통해 처리 [Source: architecture.md#3]
- **키 관리:** Supabase 서비스 롤 키는 서버 전용 [Source: architecture.md#3]
- **세션 보안:** 로그아웃 시 모든 세션 토큰 무효화

### 파일 구조
- 로그아웃 서버 액션: `app/auth/logout/actions.ts`
- 로그아웃 버튼 컴포넌트: `components/auth/logout-button.tsx`
- 대시보드 헤더: `components/dashboard/header.tsx`
- 대시보드 레이아웃: `app/dashboard/layout.tsx`

### API 명세
- Supabase Auth API 사용:
  - `supabase.auth.signOut()`
  - 에러 타입: `AuthError` (네트워크 오류 등)

### Testing
- **테스트 프레임워크:** Jest + React Testing Library
- **테스트 파일 위치:** `__tests__/auth/logout.test.tsx`
- **테스트 표준:**
  - 컴포넌트 렌더링 테스트
  - 사용자 상호작용 테스트 (버튼 클릭, 리다이렉트)
  - 서버 액션 테스트 (성공/실패 케이스)
  - Supabase Auth 모킹 필요

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음

### Completion Notes List
- 로그아웃 버튼 컴포넌트 구현 완료 (로딩 상태, 에러 메시지 포함)
- 서버 액션으로 Supabase Auth signOut 처리
- 대시보드 헤더에 로그아웃 기능 통합
- Jest 테스트 환경 설정 및 7개 테스트 케이스 작성 (모두 통과)
- 로그아웃 후 자동 리다이렉트 처리
- 보호된 페이지 접근 차단 기능 구현

### File List
- `components/auth/logout-button.tsx` - 로그아웃 버튼 컴포넌트
- `app/auth/logout/actions.ts` - 로그아웃 서버 액션
- `components/dashboard/header.tsx` - 대시보드 헤더 컴포넌트
- `app/dashboard/page.tsx` - 대시보드 페이지 (헤더 통합)
- `__tests__/auth/logout.test.tsx` - 로그아웃 테스트 파일

## QA Results
*QA 에이전트가 검토 후 채워집니다*
