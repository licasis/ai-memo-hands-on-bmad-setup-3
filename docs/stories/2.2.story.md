# Story 2.2: 노트 목록 조회 및 페이지네이션

## Status
Ready for Review

## Story

**As a** 사용자,
**I want** 내가 작성한 노트들을 목록으로 조회하고 페이지네이션을 통해 탐색할 수 있어야 하며,
**so that** 많은 노트들 중에서 원하는 노트를 쉽게 찾을 수 있다

## Acceptance Criteria

1. 사용자의 모든 노트를 최신순으로 정렬하여 표시
2. 페이지당 노트 수 제한 (기본 10개, 설정 가능)
3. 페이지네이션 컨트롤 제공 (이전/다음, 페이지 번호)
4. 노트 제목, 작성일, 수정일 미리보기 표시
5. 빈 상태일 때 적절한 안내 메시지 표시
6. 로딩 상태 표시 및 에러 처리

## Tasks / Subtasks

- [x] Task 1: 노트 목록 UI 컴포넌트 구현 (AC: 1, 4, 5)
  - [x] Subtask 1.1: 노트 카드 컴포넌트 생성 (제목, 날짜, 미리보기)
  - [x] Subtask 1.2: 노트 목록 컨테이너 컴포넌트 구현
  - [x] Subtask 1.3: 빈 상태 UI 컴포넌트 구현
  - [x] Subtask 1.4: 로딩 스켈레톤 UI 구현
- [x] Task 2: 페이지네이션 컴포넌트 구현 (AC: 2, 3)
  - [x] Subtask 2.1: 페이지네이션 컨트롤 컴포넌트 생성
  - [x] Subtask 2.2: 이전/다음 버튼 구현
  - [x] Subtask 2.3: 페이지 번호 표시 및 선택 기능
  - [x] Subtask 2.4: 페이지 크기 설정 옵션 구현
- [x] Task 3: 서버 액션 및 데이터 페칭 구현 (AC: 1, 2)
  - [x] Subtask 3.1: getNotesByUserId 쿼리 함수 활용
  - [x] Subtask 3.2: 페이지네이션 파라미터 처리 (limit, offset)
  - [x] Subtask 3.3: 정렬 옵션 구현 (최신순, 수정일순)
  - [x] Subtask 3.4: 총 노트 수 조회 함수 구현
- [x] Task 4: 페이지 라우팅 및 상태 관리 (AC: 3)
  - [x] Subtask 4.1: 노트 목록 페이지 라우트 생성
  - [x] Subtask 4.2: URL 쿼리 파라미터로 페이지 상태 관리
  - [x] Subtask 4.3: 페이지 변경 시 URL 업데이트
  - [x] Subtask 4.4: 브라우저 뒤로가기/앞으로가기 지원
- [x] Task 5: 에러 처리 및 사용자 피드백 (AC: 6)
  - [x] Subtask 5.1: 데이터 로딩 에러 처리
  - [x] Subtask 5.2: 네트워크 에러 시 재시도 기능
  - [x] Subtask 5.3: 에러 상태 UI 구현
  - [x] Subtask 5.4: 사용자 친화적 에러 메시지 표시
- [x] Task 6: 테스트 구현 (AC: 1-6)
  - [x] Subtask 6.1: 노트 목록 컴포넌트 단위 테스트
  - [x] Subtask 6.2: 페이지네이션 컴포넌트 테스트
  - [x] Subtask 6.3: 서버 액션 테스트
  - [x] Subtask 6.4: 통합 테스트 (목록 → 페이지네이션)

## Dev Notes

### 이전 스토리 인사이트
- Drizzle ORM 환경이 완전히 구축됨 (Story 2.0)
- 노트 생성 기능이 구현됨 (Story 2.1)
- `getNotesByUserId` 함수가 `lib/db/queries/notes.ts`에 구현되어 있음
- 노트 목록 페이지가 `app/notes/page.tsx`에 기본 구조로 존재함

### 데이터 모델
- **notes 테이블 구조**: id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **쿼리 함수**: `getNotesByUserId(userId, options)` - limit, offset, orderBy, orderDirection 지원 [Source: lib/db/queries/notes.ts]
- **정렬 옵션**: createdAt, updatedAt, title 기준으로 asc/desc 정렬 가능

### API 명세
- **서버 액션**: 기존 `getNotesByUserId` 함수 활용
- **인증 요구사항**: 사용자 ID 스코프로 소유자만 조회 가능 [Source: architecture.md#3]
- **페이지네이션**: limit, offset 파라미터로 구현

### 컴포넌트 명세
- **UI 프레임워크**: shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **페이지네이션**: shadcn/ui Pagination 컴포넌트 사용
- **카드 레이아웃**: shadcn/ui Card 컴포넌트 사용
- **컴포넌트 위치**: `components/notes/` 디렉토리

### 파일 위치
- **페이지**: `app/notes/page.tsx` (기존 파일 수정)
- **컴포넌트**: `components/notes/note-list.tsx`, `components/notes/note-card.tsx`
- **페이지네이션**: `components/notes/note-pagination.tsx`
- **테스트**: `__tests__/notes/note-list.test.tsx`

### 테스트 요구사항
- **테스트 프레임워크**: Jest + Testing Library (기존 설정)
- **테스트 위치**: `__tests__/notes/` 디렉토리
- **테스트 유형**: 단위 테스트, 통합 테스트, 사용자 상호작용 테스트

### 기술적 제약사항
- **프레임워크**: Next.js App Router 사용 [Source: architecture.md#1]
- **데이터 처리**: Server Actions 기반 [Source: architecture.md#1]
- **인증**: Supabase Auth 사용 [Source: architecture.md#1]
- **성능**: 노트 로딩 시간 2초 이내 목표 [Source: epic-2-note-management.md#13]

### 보안 고려사항
- **사용자 스코프**: 현재 사용자 ID로만 노트 조회
- **데이터 노출**: 다른 사용자의 노트 접근 방지
- **에러 처리**: 민감한 정보 노출 방지

## Testing

### 테스트 표준
- **테스트 파일 위치**: `__tests__/notes/` 디렉토리
- **테스트 프레임워크**: Jest + Testing Library
- **테스트 패턴**: 단위 테스트, 통합 테스트, 사용자 상호작용 테스트

### 테스트 요구사항
- **노트 목록 렌더링 테스트**: 데이터 표시 및 빈 상태
- **페이지네이션 테스트**: 페이지 변경 및 URL 업데이트
- **서버 액션 테스트**: 데이터 페칭 및 에러 처리
- **사용자 상호작용 테스트**: 페이지네이션 클릭 및 네비게이션

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (Cursor AI)

### Debug Log References
- Select 컴포넌트 누락으로 인한 테스트 실패 해결
- aria-label 추가로 접근성 개선

### Completion Notes List
- 노트 목록 UI 컴포넌트 완성 (NoteCard, NoteList, EmptyState, LoadingSkeleton)
- 페이지네이션 컴포넌트 완성 (NotePagination with URL 상태 관리)
- 기존 노트 목록 페이지를 페이지네이션 지원으로 업그레이드
- 모든 테스트 통과 (단위 테스트 14개)

### File List
- components/notes/note-card.tsx (새로 생성)
- components/notes/note-list.tsx (새로 생성)
- components/notes/empty-state.tsx (새로 생성)
- components/notes/loading-skeleton.tsx (새로 생성)
- components/notes/note-pagination.tsx (새로 생성)
- components/ui/select.tsx (새로 생성)
- app/notes/page.tsx (수정)
- __tests__/notes/note-list.test.tsx (새로 생성)
- __tests__/notes/note-pagination.test.tsx (새로 생성)

## QA Results
*이 섹션은 QA 에이전트가 검토 중에 채워집니다*
