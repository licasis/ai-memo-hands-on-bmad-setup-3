# Story 1.3: 비밀번호 재설정

## Status
Ready for Review

## Story
**As a** 기존 사용자,
**I want** 비밀번호를 잊었을 때 이메일을 통해 재설정할 수 있도록,
**so that** 계정에 다시 접근할 수 있다

## Acceptance Criteria
1. 사용자가 이메일 주소를 입력하여 비밀번호 재설정 요청을 할 수 있다
2. 이메일 형식이 유효하지 않으면 에러 메시지를 표시한다
3. 존재하지 않는 이메일로 요청 시 적절한 메시지를 표시한다
4. 비밀번호 재설정 이메일이 발송된다
5. 이메일의 링크를 클릭하면 새 비밀번호 설정 페이지로 이동한다
6. 새 비밀번호와 확인 비밀번호를 입력할 수 있다
7. 비밀번호가 일치하지 않으면 에러 메시지를 표시한다
8. 비밀번호가 8자 이상이 아니면 에러 메시지를 표시한다
9. 비밀번호 재설정 성공 시 로그인 페이지로 리다이렉트한다

## Tasks / Subtasks
- [x] 비밀번호 재설정 요청 UI 구현 (AC: 1, 2, 3)
  - [x] 이메일 입력 필드
  - [x] 에러 메시지 표시 컴포넌트
  - [x] 요청 버튼
  - [x] 성공 메시지 표시
- [x] 비밀번호 재설정 요청 서버 액션 구현 (AC: 1, 2, 3, 4)
  - [x] 이메일 유효성 검사
  - [x] Supabase Auth resetPasswordForEmail 호출
  - [x] 에러 핸들링 및 사용자 피드백
- [x] 비밀번호 재설정 페이지 구현 (AC: 5, 6, 7, 8, 9)
  - [x] 새 비밀번호 입력 필드
  - [x] 비밀번호 확인 입력 필드
  - [x] 유효성 검사 및 에러 메시지
  - [x] 재설정 버튼
- [x] 비밀번호 재설정 서버 액션 구현 (AC: 6, 7, 8, 9)
  - [x] 비밀번호 유효성 검사
  - [x] Supabase Auth updateUser 호출
  - [x] 에러 핸들링 및 성공 처리
- [x] 테스트 작성
  - [x] 비밀번호 재설정 요청 테스트
  - [x] 비밀번호 재설정 페이지 테스트
  - [x] 유효성 검사 실패 케이스 테스트

## Dev Notes

### 기술 스택 정보
- **프레임워크:** Next.js (App Router, Server Actions) [Source: architecture.md#1]
- **UI:** shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **DB/인증:** Supabase (Postgres, Auth, Storage) [Source: architecture.md#1]
- **호스팅:** Vercel (Preview/Prod) [Source: architecture.md#1]

### 데이터 모델
- 비밀번호 재설정은 Supabase Auth의 내장 기능을 사용
- 별도의 데이터베이스 테이블이 필요하지 않음
- 이메일 템플릿은 Supabase Dashboard에서 설정

### 보안 요구사항
- **권한 스코프:** 모든 인증 관련 로직은 Supabase Auth를 통해 처리 [Source: architecture.md#3]
- **키 관리:** Supabase 서비스 롤 키는 서버 전용 [Source: architecture.md#3]
- **토큰 보안:** 재설정 토큰은 일회성이며 만료 시간이 있음

### 파일 구조
- 비밀번호 재설정 요청 페이지: `app/auth/forgot-password/page.tsx`
- 비밀번호 재설정 페이지: `app/auth/reset-password/page.tsx`
- 비밀번호 재설정 요청 액션: `app/auth/forgot-password/actions.ts`
- 비밀번호 재설정 액션: `app/auth/reset-password/actions.ts`
- 비밀번호 재설정 요청 폼: `components/auth/forgot-password-form.tsx`
- 비밀번호 재설정 폼: `components/auth/reset-password-form.tsx`

### API 명세
- Supabase Auth API 사용:
  - `supabase.auth.resetPasswordForEmail({ email, redirectTo })`
  - `supabase.auth.updateUser({ password })`
  - 에러 타입: `AuthError` (이메일 없음, 토큰 만료 등)

### Testing
- **테스트 프레임워크:** Jest + React Testing Library
- **테스트 파일 위치:** `__tests__/auth/forgot-password.test.tsx`, `__tests__/auth/reset-password.test.tsx`
- **테스트 표준:**
  - 컴포넌트 렌더링 테스트
  - 사용자 상호작용 테스트 (폼 제출, 에러 표시)
  - 서버 액션 테스트 (성공/실패 케이스)
  - Supabase Auth 모킹 필요

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음

### Completion Notes List
- 비밀번호 재설정 요청 폼 구현 완료 (이메일 입력, 성공/에러 메시지 표시)
- 비밀번호 재설정 페이지 구현 완료 (새 비밀번호 입력, 확인, 유효성 검사)
- 서버 액션으로 Supabase Auth resetPasswordForEmail 및 updateUser 처리
- Jest 테스트 환경 설정 및 12개 테스트 케이스 작성 (모두 통과)
- 이메일 링크를 통한 비밀번호 재설정 플로우 완성
- 보안을 고려한 에러 메시지 처리 (존재하지 않는 이메일도 성공 메시지 표시)

### File List
- `components/auth/forgot-password-form.tsx` - 비밀번호 재설정 요청 폼
- `app/auth/forgot-password/actions.ts` - 비밀번호 재설정 요청 서버 액션
- `app/auth/forgot-password/page.tsx` - 비밀번호 재설정 요청 페이지
- `components/auth/reset-password-form.tsx` - 비밀번호 재설정 폼
- `app/auth/reset-password/actions.ts` - 비밀번호 재설정 서버 액션
- `app/auth/reset-password/page.tsx` - 비밀번호 재설정 페이지
- `__tests__/auth/forgot-password.test.tsx` - 비밀번호 재설정 요청 테스트
- `__tests__/auth/reset-password.test.tsx` - 비밀번호 재설정 테스트

## QA Results
*QA 에이전트가 검토 후 채워집니다*
