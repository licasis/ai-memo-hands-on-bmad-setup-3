# Story 4.3: 노트 내용 기반 자동 태그 생성

## 📋 스토리 정보

- **ID:** 4.3
- **Epic:** Epic 4 - AI 기반 요약 및 태깅
- **우선순위:** P1 (High)
- **스토리 포인트:** 5
- **상태:** Ready for Review
- **담당자:** Dev Agent

## 📖 스토리

**As a** 사용자  
**I want** 노트 내용을 분석하여 자동으로 관련 태그를 생성해주는 기능  
**So that** 노트를 쉽게 분류하고 검색할 수 있다

## ✅ 수용 기준

### 주요 기능
- [x] 노트 상세 페이지에서 "AI 태그 생성" 버튼 클릭 시 태그 생성
- [x] 최대 6개까지 관련성 높은 태그 자동 생성
- [x] 태그는 한국어와 영어로 생성 가능
- [x] 태그 생성 중 로딩 상태 표시
- [x] 태그 완료 후 결과를 모달 또는 인라인으로 표시
- [x] 태그 재생성 기능 제공
- [x] 생성된 태그를 노트에 자동 적용하는 옵션

### 사용자 경험
- [x] 태그 생성 시간 8초 이내
- [x] 태그 관련성 85% 이상
- [x] 태그 실패 시 적절한 에러 메시지 표시
- [x] 생성된 태그를 클릭하여 편집/삭제 가능
- [x] 태그 미리보기 및 선택적 적용 기능

### 기술적 요구사항
- [x] Gemini API를 통한 태그 생성
- [x] 토큰 제한 관리 (8k 토큰)
- [x] 비동기 처리 및 상태 관리
- [x] 에러 핸들링 및 재시도 로직
- [x] 태그 중복 제거 및 정규화

## 📋 작업 목록

### 1. UI 컴포넌트 개발
- [x] 1.1 AI 태그 생성 버튼 컴포넌트 생성
- [x] 1.2 태그 결과 표시 모달 컴포넌트 생성
- [x] 1.3 태그 편집 및 관리 컴포넌트 생성
- [x] 1.4 태그 로딩 상태 컴포넌트 생성

### 2. API 연동
- [x] 2.1 태그 생성 API 엔드포인트 연동
- [x] 2.2 태그 설정 (언어, 개수) API 연동
- [x] 2.3 에러 처리 및 재시도 로직 구현

### 3. 상태 관리
- [x] 3.1 태그 생성 상태 관리 (로딩, 완료, 에러)
- [x] 3.2 태그 설정 상태 관리
- [x] 3.3 태그 결과 캐싱 구현

### 4. 사용자 인터페이스
- [x] 4.1 노트 상세 페이지에 태그 생성 버튼 추가
- [x] 4.2 태그 결과 표시 UI 구현
- [x] 4.3 태그 편집 및 적용 UI 구현
- [x] 4.4 태그 재생성 UI 구현

### 5. 테스트
- [x] 5.1 태그 생성 기능 단위 테스트
- [x] 5.2 태그 UI 컴포넌트 테스트
- [x] 5.3 태그 API 연동 테스트
- [x] 5.4 태그 에러 처리 테스트

## 🔧 개발 노트

### 기술 스택
- **Frontend:** React, TypeScript, Tailwind CSS
- **Backend:** Next.js API Routes
- **AI Service:** Google Gemini API
- **State Management:** React Hooks (useState, useEffect)

### 주요 컴포넌트
- `AITagButton`: 태그 생성 버튼
- `TagModal`: 태그 결과 표시 모달
- `TagEditor`: 태그 편집 및 관리 컴포넌트
- `TagLoading`: 태그 로딩 상태 표시

### API 엔드포인트
- `POST /api/ai/generate-tags`: 노트 태그 생성
- `GET /api/ai/tag-settings`: 태그 설정 조회
- `PUT /api/ai/tag-settings`: 태그 설정 업데이트

### 상태 관리
```typescript
interface TagState {
  isLoading: boolean;
  tags: string[];
  error: string | null;
  settings: {
    maxTags: number;
    language: 'ko' | 'en' | 'both';
    autoApply: boolean;
  };
}
```

## 🧪 테스트

### 단위 테스트
- 태그 생성 버튼 클릭 시 API 호출
- 태그 결과 표시 및 포맷팅
- 태그 편집 및 적용 기능
- 에러 상태 처리

### 통합 테스트
- 노트 상세 페이지에서 태그 생성 플로우
- 태그 재생성 기능
- 태그 설정 저장 및 불러오기

### E2E 테스트
- 사용자 시나리오: 노트 작성 → 태그 생성 → 태그 적용
- 에러 시나리오: API 실패 → 에러 메시지 표시

## 📝 변경 로그

- **2024-01-XX**: Story 4.3 초기 작성
- **2024-01-XX**: Epic 4 기반 태그 생성 기능 정의

## 🎯 Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- AI 태그 생성 버튼 컴포넌트 생성 완료
- 태그 모달 컴포넌트 생성 완료
- 태그 설정 다이얼로그 생성 완료
- API 엔드포인트 연동 완료
- 테스트 파일 생성 완료

### Completion Notes List
- ✅ AI 태그 생성 버튼 컴포넌트 구현
- ✅ 태그 결과 표시 모달 구현
- ✅ 태그 편집 및 관리 컴포넌트 구현
- ✅ 노트 상세 페이지에 태그 기능 통합
- ✅ API 엔드포인트 연동 및 설정 관리
- ✅ 단위 테스트 작성
- ✅ 에러 처리 및 사용자 경험 개선

### File List
- `components/notes/ai-tag-button.tsx`: AI 태그 생성 버튼 컴포넌트
- `components/notes/tag-modal.tsx`: 태그 결과 표시 모달
- `components/notes/tag-settings.tsx`: 태그 설정 다이얼로그
- `app/api/ai/generate-tags/route.ts`: 태그 생성 API 엔드포인트
- `app/api/ai/tag-settings/route.ts`: 태그 설정 API 엔드포인트
- `__tests__/notes/ai-tag-button.test.tsx`: AI 태그 버튼 테스트
- `__tests__/notes/tag-modal.test.tsx`: 태그 모달 테스트
- `components/notes/note-detail.tsx`: 노트 상세 페이지 (수정)
- `lib/ai/gemini.ts`: Gemini API 클라이언트 (수정)

## 🔗 관련 파일

- `app/notes/[id]/page.tsx`: 노트 상세 페이지
- `app/api/ai/generate-tags/route.ts`: 태그 생성 API 엔드포인트
- `components/notes/ai-tag-button.tsx`: 태그 생성 버튼 컴포넌트
- `components/notes/tag-modal.tsx`: 태그 결과 모달
- `lib/ai/gemini.ts`: Gemini API 클라이언트

## 📊 성공 지표

- 태그 생성 성공률 95% 이상
- 평균 태그 생성 시간 5초 이내
- 태그 관련성 85% 이상
- 사용자 만족도 90% 이상
