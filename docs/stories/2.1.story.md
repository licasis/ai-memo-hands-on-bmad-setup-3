# Story 2.1: 노트 생성 (제목 + 본문)

## Status
Ready for Review

## Story

**As a** 사용자,
**I want** 제목과 본문을 입력하여 새로운 노트를 생성할 수 있어야 하며,
**so that** 아이디어나 정보를 빠르게 기록하고 저장할 수 있다

## Acceptance Criteria

1. 사용자가 노트 제목과 본문을 입력할 수 있는 폼 제공
2. 제목과 본문 모두 필수 입력 항목으로 검증
3. 노트 생성 시 현재 사용자 ID가 자동으로 연결됨
4. 노트 생성 성공 시 사용자에게 피드백 제공
5. 노트 생성 실패 시 적절한 에러 메시지 표시
6. 생성된 노트는 데이터베이스에 안전하게 저장됨

## Tasks / Subtasks

- [x] Task 1: 노트 생성 UI 컴포넌트 구현 (AC: 1, 2)
  - [x] Subtask 1.1: 노트 생성 폼 컴포넌트 생성
  - [x] Subtask 1.2: 제목 입력 필드 구현 (shadcn/ui Input 사용)
  - [x] Subtask 1.3: 본문 입력 필드 구현 (textarea)
  - [x] Subtask 1.4: 폼 유효성 검사 로직 구현
  - [x] Subtask 1.5: 제출 버튼 및 로딩 상태 구현
- [x] Task 2: 서버 액션 구현 (AC: 3, 6)
  - [x] Subtask 2.1: createNote 서버 액션 구현
  - [x] Subtask 2.2: 사용자 인증 확인 로직 추가
  - [x] Subtask 2.3: Drizzle ORM을 통한 노트 저장
  - [x] Subtask 2.4: 에러 핸들링 및 로깅 구현
- [x] Task 3: 사용자 피드백 및 에러 처리 (AC: 4, 5)
  - [x] Subtask 3.1: 성공 메시지 토스트 구현
  - [x] Subtask 3.2: 에러 메시지 표시 로직
  - [x] Subtask 3.3: 폼 리셋 기능 구현
  - [x] Subtask 3.4: 로딩 상태 UI 구현
- [x] Task 4: 페이지 라우팅 및 네비게이션 (AC: 1)
  - [x] Subtask 4.1: 노트 생성 페이지 라우트 생성
  - [x] Subtask 4.2: 생성 후 노트 목록으로 리다이렉트
  - [x] Subtask 4.3: 취소 버튼 및 뒤로가기 처리
- [x] Task 5: 테스트 구현 (AC: 1-6)
  - [x] Subtask 5.1: 노트 생성 폼 단위 테스트
  - [x] Subtask 5.2: 서버 액션 단위 테스트
  - [x] Subtask 5.3: 통합 테스트 (폼 → 서버 액션 → DB)
  - [x] Subtask 5.4: 에러 시나리오 테스트

## Dev Notes

### 이전 스토리 인사이트
- Drizzle ORM 환경이 완전히 구축됨 (Story 2.0)
- 데이터베이스 스키마와 CRUD 쿼리 함수들이 준비됨
- `createNote` 함수가 `lib/db/queries/notes.ts`에 구현되어 있음
- TypeScript 타입 정의가 완료되어 타입 안전성 보장

### 데이터 모델
- **notes 테이블 구조**: id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **필수 필드**: user_id (자동 설정), title, content [Source: architecture.md#2]
- **타입 정의**: CreateNoteData 인터페이스 사용 [Source: lib/db/types.ts]

### API 명세
- **서버 액션**: `saveNote` - 노트 작성/수정 [Source: architecture.md#4]
- **인증 요구사항**: 사용자 ID 스코프로 소유자만 CRUD 가능 [Source: architecture.md#3]
- **에러 처리**: Supabase 서비스 롤 키는 서버 전용 [Source: architecture.md#3]

### 컴포넌트 명세
- **UI 프레임워크**: shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **폼 라이브러리**: react-hook-form (기존 설치됨)
- **유효성 검사**: zod (기존 설치됨)
- **컴포넌트 위치**: `components/notes/` 디렉토리

### 파일 위치
- **페이지**: `app/notes/create/page.tsx`
- **서버 액션**: `app/notes/create/actions.ts`
- **컴포넌트**: `components/notes/create-note-form.tsx`
- **테스트**: `__tests__/notes/create-note.test.tsx`

### 테스트 요구사항
- **테스트 프레임워크**: Jest + Testing Library (기존 설정)
- **테스트 위치**: `__tests__/notes/` 디렉토리
- **테스트 유형**: 단위 테스트, 통합 테스트, 에러 시나리오 테스트

### 기술적 제약사항
- **프레임워크**: Next.js App Router 사용 [Source: architecture.md#1]
- **데이터 처리**: Server Actions 기반 [Source: architecture.md#1]
- **인증**: Supabase Auth 사용 [Source: architecture.md#1]
- **성능**: 노트 저장 성공률 99.5% 이상 목표 [Source: epic-2-note-management.md#13]

### 보안 고려사항
- **사용자 스코프**: 노트 생성 시 현재 사용자 ID 자동 연결
- **입력 검증**: 제목과 본문 필수 입력 검증
- **에러 처리**: 민감한 정보 노출 방지

## Testing

### 테스트 표준
- **테스트 파일 위치**: `__tests__/notes/` 디렉토리
- **테스트 프레임워크**: Jest + Testing Library
- **테스트 패턴**: 단위 테스트, 통합 테스트, 사용자 상호작용 테스트

### 테스트 요구사항
- **폼 유효성 검사 테스트**: 필수 필드 검증
- **서버 액션 테스트**: 노트 생성 로직 검증
- **사용자 상호작용 테스트**: 폼 제출 및 피드백
- **에러 시나리오 테스트**: 네트워크 오류, 인증 실패 등

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (2024-12-19)

### Debug Log References
- Jest 테스트에서 순환 import 문제 발생 → 서버 액션에서 직접 데이터베이스 연결하도록 수정
- 폼 컴포넌트 테스트 8개 모두 통과
- 서버 액션 테스트 8개 모두 통과

### Completion Notes List
- 노트 생성 폼 컴포넌트 완성 (react-hook-form + zod 사용)
- 서버 액션에서 사용자 인증 및 데이터 검증 구현
- Drizzle ORM을 통한 데이터베이스 저장 로직 구현
- 포괄적인 테스트 커버리지 달성 (16개 테스트)
- 모든 Acceptance Criteria 충족

### File List
**생성된 파일:**
- `components/notes/create-note-form.tsx` - 노트 생성 폼 컴포넌트
- `app/notes/create/page.tsx` - 노트 생성 페이지
- `app/notes/create/actions.ts` - 노트 생성 서버 액션
- `app/notes/page.tsx` - 노트 목록 페이지
- `__tests__/notes/create-note.test.tsx` - 폼 컴포넌트 테스트
- `__tests__/notes/create-note-actions.test.ts` - 서버 액션 테스트

**수정된 파일:**
- 없음 (새로운 기능 구현)

## QA Results
*이 섹션은 QA 에이전트가 검토 중에 채워집니다*
