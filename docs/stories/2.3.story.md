# Story 2.3: 노트 상세 조회

## Status
Ready for Review

## Story

**As a** 사용자,
**I want** 특정 노트를 클릭하여 전체 내용을 상세히 조회할 수 있어야 하며,
**so that** 노트의 완전한 내용을 읽고 검토할 수 있다

## Acceptance Criteria

1. 노트 목록에서 특정 노트 클릭 시 상세 페이지로 이동
2. 노트의 전체 제목과 본문 내용을 표시
3. 노트 작성일과 수정일 정보 표시
4. 노트 수정 및 삭제 버튼 제공
5. 뒤로가기 버튼으로 목록으로 돌아가기
6. 존재하지 않는 노트 접근 시 404 에러 처리

## Tasks / Subtasks

- [x] Task 1: 노트 상세 페이지 라우팅 구현 (AC: 1, 6)
  - [x] Subtask 1.1: 동적 라우트 생성 (`/notes/[id]`)
  - [x] Subtask 1.2: 노트 ID 유효성 검증
  - [x] Subtask 1.3: 404 에러 페이지 구현
  - [x] Subtask 1.4: 노트 존재 여부 확인 로직
- [x] Task 2: 노트 상세 조회 UI 컴포넌트 구현 (AC: 2, 3)
  - [x] Subtask 2.1: 노트 상세 헤더 컴포넌트 (제목, 날짜)
  - [x] Subtask 2.2: 노트 본문 표시 컴포넌트
  - [x] Subtask 2.3: 메타데이터 표시 (작성일, 수정일)
  - [x] Subtask 2.4: 반응형 레이아웃 구현
- [x] Task 3: 액션 버튼 및 네비게이션 구현 (AC: 4, 5)
  - [x] Subtask 3.1: 수정 버튼 구현 (노트 수정 페이지로 이동)
  - [x] Subtask 3.2: 삭제 버튼 구현 (확인 다이얼로그 포함)
  - [x] Subtask 3.3: 뒤로가기 버튼 구현
  - [x] Subtask 3.4: 액션 버튼 레이아웃 구성
- [x] Task 4: 서버 액션 및 데이터 페칭 구현 (AC: 2, 3)
  - [x] Subtask 4.1: getNoteById 쿼리 함수 활용
  - [x] Subtask 4.2: 사용자 권한 확인 (소유자만 조회)
  - [x] Subtask 4.3: 데이터 로딩 상태 처리
  - [x] Subtask 4.4: 에러 핸들링 구현
- [x] Task 5: 삭제 기능 구현 (AC: 4)
  - [x] Subtask 5.1: deleteNote 서버 액션 구현
  - [x] Subtask 5.2: 삭제 확인 다이얼로그 구현
  - [x] Subtask 5.3: 삭제 성공 시 목록으로 리다이렉트
  - [x] Subtask 5.4: 삭제 실패 시 에러 메시지 표시
- [x] Task 6: 테스트 구현 (AC: 1-6)
  - [x] Subtask 6.1: 노트 상세 페이지 렌더링 테스트
  - [x] Subtask 6.2: 404 에러 처리 테스트
  - [x] Subtask 6.3: 액션 버튼 상호작용 테스트
  - [x] Subtask 6.4: 삭제 기능 통합 테스트

## Dev Notes

### 이전 스토리 인사이트
- 노트 목록 조회 및 페이지네이션 기능이 구현됨 (Story 2.2)
- `getNotesByUserId` 함수가 구현되어 있음
- 노트 생성 기능이 완성됨 (Story 2.1)

### 데이터 모델
- **notes 테이블 구조**: id, user_id, title, content, created_at, updated_at [Source: architecture.md#2]
- **쿼리 함수**: `getNoteById(noteId)` - 단일 노트 조회 필요
- **삭제 함수**: `deleteNote(noteId)` - 노트 삭제 필요

### API 명세
- **서버 액션**: `getNoteById`, `deleteNote` 구현 필요
- **인증 요구사항**: 사용자 ID 스코프로 소유자만 조회/삭제 가능 [Source: architecture.md#3]
- **에러 처리**: 404 Not Found, 403 Forbidden 처리

### 컴포넌트 명세
- **UI 프레임워크**: shadcn/ui + Tailwind + Radix UI [Source: architecture.md#1]
- **다이얼로그**: shadcn/ui Dialog 컴포넌트 사용
- **버튼**: shadcn/ui Button 컴포넌트 사용
- **컴포넌트 위치**: `components/notes/` 디렉토리

### 파일 위치
- **페이지**: `app/notes/[id]/page.tsx`
- **서버 액션**: `app/notes/[id]/actions.ts`
- **컴포넌트**: `components/notes/note-detail.tsx`
- **404 페이지**: `app/notes/[id]/not-found.tsx`
- **테스트**: `__tests__/notes/note-detail.test.tsx`

### 테스트 요구사항
- **테스트 프레임워크**: Jest + Testing Library (기존 설정)
- **테스트 위치**: `__tests__/notes/` 디렉토리
- **테스트 유형**: 단위 테스트, 통합 테스트, 에러 시나리오 테스트

### 기술적 제약사항
- **프레임워크**: Next.js App Router 사용 [Source: architecture.md#1]
- **데이터 처리**: Server Actions 기반 [Source: architecture.md#1]
- **인증**: Supabase Auth 사용 [Source: architecture.md#1]
- **성능**: 노트 로딩 시간 2초 이내 목표 [Source: epic-2-note-management.md#13]

### 보안 고려사항
- **사용자 스코프**: 현재 사용자 ID로만 노트 조회/삭제
- **권한 확인**: 소유자가 아닌 노트 접근 방지
- **에러 처리**: 민감한 정보 노출 방지

## Testing

### 테스트 표준
- **테스트 파일 위치**: `__tests__/notes/` 디렉토리
- **테스트 프레임워크**: Jest + Testing Library
- **테스트 패턴**: 단위 테스트, 통합 테스트, 에러 시나리오 테스트

### 테스트 요구사항
- **노트 상세 렌더링 테스트**: 데이터 표시 및 메타데이터
- **404 에러 테스트**: 존재하지 않는 노트 접근
- **권한 테스트**: 다른 사용자 노트 접근 방지
- **삭제 기능 테스트**: 확인 다이얼로그 및 삭제 프로세스

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (Cursor AI)

### Debug Log References
- Dialog 컴포넌트 누락으로 인한 테스트 실패 해결
- 테스트 텍스트 매칭 문제 해결 (정규식 사용)

### Completion Notes List
- 노트 상세 페이지 완성 (동적 라우팅, 404 처리)
- 노트 상세 UI 컴포넌트 완성 (NoteDetail, DeleteConfirmDialog)
- 삭제 기능 완성 (서버 액션, API 라우트, 확인 다이얼로그)
- 모든 테스트 통과 (단위 테스트 14개)

### File List
- app/notes/[id]/page.tsx (새로 생성)
- app/notes/[id]/not-found.tsx (새로 생성)
- app/notes/[id]/actions.ts (새로 생성)
- app/api/notes/[id]/route.ts (새로 생성)
- components/notes/note-detail.tsx (새로 생성)
- components/notes/delete-confirm-dialog.tsx (새로 생성)
- components/ui/dialog.tsx (새로 생성)
- __tests__/notes/note-detail.test.tsx (새로 생성)
- __tests__/notes/note-detail-404.test.tsx (새로 생성)

## QA Results
*이 섹션은 QA 에이전트가 검토 중에 채워집니다*

### Change Log
| 날짜 | 버전 | 변경사항 | 담당자 |
|------|------|----------|--------|
| 2024-12-19 | 1.0 | 초기 스토리 생성 | Bob (SM) |
| 2024-12-19 | 1.1 | 노트 상세 페이지 구현 완료 | James (Dev) |
| 2024-12-19 | 1.2 | 삭제 기능 및 404 처리 완료 | James (Dev) |
| 2024-12-19 | 1.3 | 테스트 구현 및 통과 완료 | James (Dev) |
