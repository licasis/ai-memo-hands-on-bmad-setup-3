# Story 4.2: 노트 내용 기반 자동 요약 생성

## 📋 스토리 정보

- **ID:** 4.2
- **Epic:** Epic 4 - AI 기반 요약 및 태깅
- **우선순위:** P1 (High)
- **스토리 포인트:** 5
- **상태:** Ready for Review
- **담당자:** Dev Agent

## 📖 스토리

**As a** 사용자  
**I want** 노트 내용을 자동으로 요약해주는 기능  
**So that** 긴 노트의 핵심 내용을 빠르게 파악할 수 있다

## ✅ 수용 기준

### 주요 기능
- [ ] 노트 상세 페이지에서 "AI 요약" 버튼 클릭 시 요약 생성
- [ ] 요약은 3-6개 불릿 포인트로 구성
- [ ] 요약 길이는 사용자가 설정 가능 (50-500자)
- [ ] 요약 생성 중 로딩 상태 표시
- [ ] 요약 완료 후 결과를 모달 또는 인라인으로 표시
- [ ] 요약 재생성 기능 제공

### 사용자 경험
- [ ] 요약 생성 시간 10초 이내
- [ ] 요약 품질이 사용자 만족도 90% 이상
- [ ] 요약 실패 시 적절한 에러 메시지 표시
- [ ] 요약 결과를 복사할 수 있는 기능

### 기술적 요구사항
- [ ] Gemini API를 통한 요약 생성
- [ ] 토큰 제한 관리 (8k 토큰)
- [ ] 비동기 처리 및 상태 관리
- [ ] 에러 핸들링 및 재시도 로직

## 📋 작업 목록

### 1. UI 컴포넌트 개발
- [x] 1.1 AI 요약 버튼 컴포넌트 생성
- [x] 1.2 요약 결과 표시 모달 컴포넌트 생성
- [x] 1.3 요약 설정 다이얼로그 컴포넌트 생성
- [x] 1.4 요약 로딩 상태 컴포넌트 생성

### 2. API 연동
- [x] 2.1 요약 API 엔드포인트 연동
- [x] 2.2 요약 설정 (길이, 스타일) API 연동
- [x] 2.3 에러 처리 및 재시도 로직 구현

### 3. 상태 관리
- [x] 3.1 요약 생성 상태 관리 (로딩, 완료, 에러)
- [x] 3.2 요약 설정 상태 관리
- [x] 3.3 요약 결과 캐싱 구현

### 4. 사용자 인터페이스
- [x] 4.1 노트 상세 페이지에 요약 버튼 추가
- [x] 4.2 요약 결과 표시 UI 구현
- [x] 4.3 요약 설정 UI 구현
- [x] 4.4 요약 재생성 UI 구현

### 5. 테스트
- [x] 5.1 요약 생성 기능 단위 테스트
- [x] 5.2 요약 UI 컴포넌트 테스트
- [x] 5.3 요약 API 연동 테스트
- [x] 5.4 요약 에러 처리 테스트

## 🔧 개발 노트

### 기술 스택
- **Frontend:** React, TypeScript, Tailwind CSS
- **Backend:** Next.js API Routes
- **AI Service:** Google Gemini API
- **State Management:** React Hooks (useState, useEffect)

### 주요 컴포넌트
- `AISummaryButton`: 요약 생성 버튼
- `SummaryModal`: 요약 결과 표시 모달
- `SummarySettings`: 요약 설정 다이얼로그
- `SummaryLoading`: 요약 로딩 상태 표시

### API 엔드포인트
- `POST /api/ai/summarize`: 노트 요약 생성
- `GET /api/ai/summary-settings`: 요약 설정 조회
- `PUT /api/ai/summary-settings`: 요약 설정 업데이트

### 상태 관리
```typescript
interface SummaryState {
  isLoading: boolean;
  summary: string | null;
  error: string | null;
  settings: {
    maxLength: number;
    style: 'bullet' | 'paragraph';
  };
}
```

## 🧪 테스트

### 단위 테스트
- 요약 버튼 클릭 시 API 호출
- 요약 결과 표시 및 포맷팅
- 요약 설정 변경 및 적용
- 에러 상태 처리

### 통합 테스트
- 노트 상세 페이지에서 요약 생성 플로우
- 요약 재생성 기능
- 요약 설정 저장 및 불러오기

### E2E 테스트
- 사용자 시나리오: 노트 작성 → 요약 생성 → 결과 확인
- 에러 시나리오: API 실패 → 에러 메시지 표시

## 📝 변경 로그

- **2024-01-XX**: Story 4.2 초기 작성
- **2024-01-XX**: Epic 4 기반 요약 생성 기능 정의
- **2024-01-XX**: AI 요약 기능 개발 완료

## 🎯 Dev Agent Record

### Agent Model Used
- Claude Sonnet 4

### Debug Log References
- AI 요약 버튼 컴포넌트 생성 완료
- 요약 모달 컴포넌트 생성 완료
- 요약 설정 다이얼로그 생성 완료
- API 엔드포인트 연동 완료
- 테스트 파일 생성 완료

### Completion Notes List
- ✅ AI 요약 버튼 컴포넌트 구현
- ✅ 요약 결과 표시 모달 구현
- ✅ 요약 설정 다이얼로그 구현
- ✅ 노트 상세 페이지에 요약 기능 통합
- ✅ API 엔드포인트 연동 및 설정 관리
- ✅ 단위 테스트 작성
- ✅ 에러 처리 및 사용자 경험 개선

### File List
- `components/notes/ai-summary-button.tsx`: AI 요약 버튼 컴포넌트
- `components/notes/summary-modal.tsx`: 요약 결과 표시 모달
- `components/notes/summary-settings.tsx`: 요약 설정 다이얼로그
- `app/api/ai/summary-settings/route.ts`: 요약 설정 API 엔드포인트
- `__tests__/notes/ai-summary-button.test.tsx`: AI 요약 버튼 테스트
- `__tests__/notes/summary-modal.test.tsx`: 요약 모달 테스트
- `components/notes/note-detail.tsx`: 노트 상세 페이지 (수정)
- `app/api/ai/summarize/route.ts`: 요약 API (수정)

## 🔗 관련 파일

- `app/notes/[id]/page.tsx`: 노트 상세 페이지
- `app/api/ai/summarize/route.ts`: 요약 API 엔드포인트
- `components/notes/ai-summary-button.tsx`: 요약 버튼 컴포넌트
- `components/notes/summary-modal.tsx`: 요약 결과 모달
- `lib/ai/gemini.ts`: Gemini API 클라이언트

## 📊 성공 지표

- 요약 생성 성공률 95% 이상
- 평균 요약 생성 시간 5초 이내
- 사용자 만족도 90% 이상
- 요약 품질 점수 4.5/5.0 이상
